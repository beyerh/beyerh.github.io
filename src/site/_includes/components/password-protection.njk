<script>
// Client-side password protection for Digital Garden
(function() {
  // Configuration - this will be replaced during build
  const CORRECT_PASSWORD = '{{ meta.sitePassword | default("test123") }}';
  
  // Check if user is already authenticated
  function isAuthenticated() {
    return sessionStorage.getItem('digitalGardenAuth') === 'true';
  }
  
  // Show password prompt
  function showPasswordPrompt() {
    // Create overlay
    const overlay = document.createElement('div');
    overlay.id = 'password-overlay';
    overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      z-index: 999999;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    `;
    
    // Create login container
    const container = document.createElement('div');
    container.style.cssText = `
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 400px;
      margin: 1rem;
    `;
    
    container.innerHTML = `
      <div style="text-align: center; margin-bottom: 2rem;">
        <h1 style="color: #333; margin: 0; font-size: 1.8rem;">M2205</h1>
        <p style="color: #666; margin: 0.5rem 0 0 0;">Please enter the course password to access materials</p>
      </div>
      <div id="error-message" style="background: #fee; color: #c33; padding: 0.75rem; border-radius: 5px; margin-bottom: 1rem; border: 1px solid #fcc; display: none;">
        Incorrect password. Please try again.
      </div>
      <form id="password-form" style="margin: 0;">
        <div style="margin-bottom: 1.5rem;">
          <label for="password-input" style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 500;">Course Password</label>
          <input type="password" id="password-input" required autofocus style="width: 100%; padding: 0.75rem; border: 2px solid #e1e5e9; border-radius: 5px; font-size: 1rem; transition: border-color 0.3s;">
        </div>
        <button type="submit" style="width: 100%; padding: 0.75rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 5px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: transform 0.2s;">
          Access Course
        </button>
      </form>
    `;
    
    overlay.appendChild(container);
    document.body.appendChild(overlay);
    
    // Focus password input
    document.getElementById('password-input').focus();
    
    // Handle form submission
    document.getElementById('password-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const password = document.getElementById('password-input').value;
      
      if (password === CORRECT_PASSWORD) {
        sessionStorage.setItem('digitalGardenAuth', 'true');
        document.body.removeChild(overlay);
      } else {
        document.getElementById('error-message').style.display = 'block';
        document.getElementById('password-input').value = '';
        document.getElementById('password-input').focus();
      }
    });
    
    // Handle input focus
    document.getElementById('password-input').addEventListener('focus', function() {
      this.style.borderColor = '#667eea';
    });
    
    document.getElementById('password-input').addEventListener('blur', function() {
      this.style.borderColor = '#e1e5e9';
    });
  }
  
  // Main authentication logic
  if (!isAuthenticated()) {
    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', showPasswordPrompt);
    } else {
      showPasswordPrompt();
    }
  }
})();
</script>
